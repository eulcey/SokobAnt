language: common-lisp
sudo: false
addons:
  apt:
    packages:
    - zip
env:
  global:
  - GAMEKIT_SYSTEM_NAME: sokob-ant
  - GAMEKIT_APPLICATION_PACKAGE: sokob-ant
  - GAMEKIT_APPLICATION_MAIN_CLASS: sokob-ant
  - PATH: "~/.bodge/bin/:$PATH"
  - GAMEKIT_TARGET_PACKAGE: "$GAMEKIT_SYSTEM_NAME-x86-64-$TRAVIS_OS_NAME-$TRAVIS_BRANCH.zip"
  - GAMEKIT_BUILD_DIR: "/tmp/$GAMEKIT_SYSTEM_NAME"
  - secure: k2Ruu/XovKY2N+F7NXCAImN7IamN8EcflZYqBUIPAkvcXRMxN21+wFNNCtWciOLFHaktv6h9O4DeLyUVz4bbaoNwKHARqGgbCaC/csI1KA3W0Hb2OzqzKGg71e11WCJeodk8BMJ/3NbnKrOCeyG+4IIWcMPaY/R3JvVNohSDBXPDKOUoSZjn9SANphorQ7glVMekFyy90M9sfa1ZZ/et17Po/i6YaWQIKjQqnYWLuBOwPQ11/iCoEN0xxV9dtitjj5Qv0qLjjSefM2COUVQkVB/Q0dCnjez04pQcOcJsy4eYVITZlbsFD0XV+VmbssK+9SzxDQUCIm+xbtB7S1qNn9MtBAYuHRuy/i93cmx54dOVLP0ayvMgmFD0rUStLe1R3zzKVKxDsUUZj74gXhilqbaWrXlbgjxqkXzNoTAnGHo61DghiQ8kEKa0H3kQ/E9RFGZ7G0ICmdmxJdUP3aQepFmYJstKU+xwVTfC7nJU03xndKJIe+dj9OQDSjdV2Fap+bBHwrEaz4CPDz8KwfPuQnoOow2nEFB+3Zu0P5BOKfDiuB4PaqgmQRQ2vQkVY+jprD7oMeIxhP355lMVeDYd1biImGM8zdl1wTK3yVBZcYvBsYTTCIc17ajOgT50mf+DLMxNBF3vhHtHIPGLZun5xobw2Xob2E3j4p4giyfo4Uw=

branches:
  only:
  - "/^v\\d+(\\.\\d+)+$/"
os:
- linux
- osx
install:
- curl -L http://bodge.borodust.org/files/install.sh | sh
- lisp install-dist
script:
- 'lisp build-gamekit-system $GAMEKIT_SYSTEM_NAME $GAMEKIT_APPLICATION_PACKAGE $GAMEKIT_APPLICATION_MAIN_CLASS
  $TRAVIS_BUILD_DIR $GAMEKIT_BUILD_DIR

  '
before_deploy:
- mv "$GAMEKIT_BUILD_DIR/$GAMEKIT_SYSTEM_NAME.zip" $GAMEKIT_TARGET_PACKAGE
deploy:
  provider: releases
  api-key: "$GITHUB_TOKEN"
  file: "$GAMEKIT_TARGET_PACKAGE"
  skip_cleanup: true
  overwrite: true
  on:
    tags: true
